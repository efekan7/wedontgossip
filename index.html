<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>We Don’t Gossip</title>
<style>
body { background-color:black; color:white; font-family: Georgia, serif; text-align:center; margin:0; padding:0;}
.container { max-width:800px; margin:auto; padding:50px; }
textarea { width:100%; height:100px; margin-bottom:10px; background-color:#222; color:white; border:none; padding:10px;}
button { width:100%; padding:10px; background-color:#333; color:white; border:none; cursor:pointer; }
.message { border-bottom:1px solid #444; padding:10px 0; text-align:left; }
nav a { color:white; margin:0 15px; text-decoration:none; font-weight:bold; }
nav a:hover { text-decoration:underline; }
section { margin-bottom:50px; }
img, video { max-width:100%; margin-top:10px; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // Firebase config - kendi proje ile değiştir
  const firebaseConfig = {
    apiKey: "AIzaSyDRYbwuiOpopVmw3I5OT_M4cu-RPIshH94",
    authDomain: "wedontgossip.firebaseapp.com",
    databaseURL: "https://wedontgossip-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "wedontgossip",
    storageBucket: "wedontgossip.firebasestorage.app",
    messagingSenderId: "364749377862",
    appId: "1:364749377862:web:9ba6a6e4d327adf0411547",
    measurementId: "G-LS2LZRR3X4"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  // Mesaj gönderme fonksiyonu
  function postMessage() {
    const msg = document.getElementById('newMessage').value;
    const fileInput = document.getElementById('mediaInput');
    const file = fileInput.files[0];

    if(msg.trim() === "" && !file) return;

    if(file) {
      const storageRef = storage.ref('media/' + Date.now() + '-' + file.name);
      storageRef.put(file).then(() => {
        storageRef.getDownloadURL().then((url) => {
          db.ref('messages').push({
            text: msg,
            media: url,
            type: file.type,
            time: Date.now()
          });
        });
      });
    } else {
      db.ref('messages').push({
        text: msg,
        media: null,
        time: Date.now()
      });
    }

    document.getElementById('newMessage').value = "";
    fileInput.value = "";
  }

  // Mesajları gösterme
  db.ref('messages').on('child_added', snapshot => {
    const data = snapshot.val();
    const messagesDiv = document.getElementById('messages');
    const msgDiv = document.createElement('div');
    msgDiv.className = "message";

    let content = `<strong>Whispers:</strong> <em>“${data.text || ''}”</em><br>`;
    if(data.media){
      if(data.type.startsWith("image")){
        content += `<img src="${data.media}"><br>`;
      } else if(data.type.startsWith("video")){
        content += `<video controls><source src="${data.media}" type="${data.type}"></video><br>`;
      }
    }
    content += "<strong>XOXO</strong>";

    msgDiv.innerHTML = content;
    messagesDiv.prepend(msgDiv);
  });

  // 24 saatten eski mesaj ve medyaları silme (tarayıcı tabanlı)
  setInterval(() => {
    const now = Date.now();
    db.ref('messages').once('value', snapshot => {
      snapshot.forEach(child => {
        const msg = child.val();
        if(now - msg.time > 24*60*60*1000){ // 24 saat
          db.ref('messages/' + child.key).remove();
          if(msg.media){
            const storageRef = storage.refFromURL(msg.media);
            storageRef.delete().catch(err => console.log(err));
          }
        }
      });
    });
  }, 60*60*1000); // Her 1 saatte bir kontrol
</script>
</head>
<body>

<div class="container">

  <!-- Menu -->
  <nav>
    <a href="#home">Home</a>
    <a href="#whispers">Whispers</a>
    <a href="#about">About</a>
  </nav>

  <!-- Home Section -->
  <section id="home">
    <h1>Spotted.</h1>
    <p>Secrets don’t stay hidden forever.<br>
       This is where whispers turn into words.<br><br>
       Seen something?<br>
       Heard something?<br><br>
       Leave it here.<br><br>
       <strong>XOXO</strong>
    </p>
  </section>

  <!-- Whispers Section -->
  <section id="whispers">
    <h2>Whispers</h2>
    <div id="messages"></div>
    <textarea id="newMessage" placeholder="Type your whisper here..."></textarea>
    <input type="file" id="mediaInput" accept="image/*,video/*">
    <button onclick="postMessage()">Send</button>
  </section>

  <!-- About Section -->
  <section id="about">
    <h2>About</h2>
    <p>We don’t gossip.<br>
       We whisper.<br><br>
       <strong>XOXO</strong>
    </p>
  </section>

</div>

</body>
</html>
